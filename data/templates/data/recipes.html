<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <!--<script type="text/javascript" src="/media/web/jquery.js"></script>-->
    <link href="/static/css/bootstrap.min.css" rel="stylesheet">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
    <script>
      function addItem() {
        $('#ingredientList').append('<div class="ingredient"><select>{% for item in itemlist %}<option value="{{item.item_name}}">{{item.item_name}}</option>{% endfor %}</select><p style="display: inline;">Quantity:</p><input style="display: inline;" type=number></div>');
      };
      function createRecipe() {
        var ingredientContainer = document.querySelector('#ingredientList');
        var recipename = document.getElementById('recipeName').value;
        var result = document.getElementById('result').value
        var resultquantity = document.getElementById('resultQuantity').value
        var ingredientstosend = [];
        var ingredientCount = ingredientContainer.children.length;
        var isMysticForge = document.getElementById('isMysticForge').checked;
        for (var i=0; i<ingredientCount; i++) {
          ingredientstosend.push({name: ingredientContainer.children[i].children[0].value, quantity: ingredientContainer.children[i].children[2].value});
        }
        console.log(ingredientstosend);
        $.ajax({url: '/data/createrecipe/', data: { recipename: recipename, ingredients: JSON.stringify(ingredientstosend), result: result, resultquantity: resultquantity, isMysticForge: isMysticForge}, type: 'POST'});
      };
    </script>
    <title>GuildWars2 Cookbook</title>
  </head>
  <body>

    <!-- header bar -->
    <nav class="navbar navbar-default">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse">
          </button>
          <a class="navbar-brand" href="{% url 'index' %}">GuildWars2 Market Data</a>
        </div>
      </div>
    </nav>


    <table>
      <thead>
        <tr>
          <th>ingredients</th>
          <th>result</th>
          <th>current profit</th>
        </tr>
      </thead>
      <tbody>
      {% for recipe in recipelist %}
        <tr>
          {% for ingredient in recipe.ingredients %}
          <td><img style="height: 32px; width: 32px" src="{{ingredient.item_icon}}"/>
            <span>{{ingredient.item_name}}</span>
            <span><img style="height: 16px; width: 16px" src="/static/data/Gold_coin.png">{{ingredient.item_buy_price.gold}}<img style="height: 16px; width: 16px" src="/static/data/Silver_coin.png">{{ingredient.item_buy_price.silver}}<img style="height: 16px; width: 16px" src="/static/data/Copper_coin.png">{{ingredient.item_buy_price.copper}}</span>
            <span> x {{ingredient.quantity}}</span>
          </td>
          {% endfor %}
          <td><span><img style="height: 32px; width: 32px" src="{{recipe.result.item_icon}}">{{recipe.result.item_name}}<span> x {{recipe.result.quantity}}</span></span></td>
          <td style="background-color: {% if recipe.profit.loss == True %}red{% else %}green{% endif %}"><img style="height: 16px; width: 16px" src="/static/data/Gold_coin.png">{{recipe.profit.gold}}<img style="height: 16px; width: 16px" src="/static/data/Silver_coin.png">{{recipe.profit.silver}}<img style="height: 16px; width: 16px" src="/static/data/Copper_coin.png">{{recipe.profit.copper}}</td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
    <h2>Create a recipe</h2>
    <p style="display: inline;">Recipe nickname</p>
    <input id="recipeName" type=text><p style="display: inline;">  Mystic Forge recipe: </p><input style="display: inline;" id=isMysticForge type="checkbox">
    <div id="ingredientList">
      <div class="ingredient">
       <select>{% for item in itemlist %}<option value="{{item.item_name}}">{{item.item_name}}</option>{% endfor %}</select><p style="display: inline;">Quantity:</p><input style="display: inline;" type=number>
     </div>
    </div>
    <button onclick='addItem()'>add ingredient</button>
    <h3>Product</h3>
    <select id="result">{% for item in itemlist %}<option value="{{item.item_name}}">{{item.item_name}}</option>{% endfor %}</select><p style="display: inline;">Quantity:</p><input id="resultQuantity" style="display: inline;" type=number>
    <br><button onclick='createRecipe()'>create recipe</button>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script> -->
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="/static/js/bootstrap.min.js"></script>
  </body>
</html>
